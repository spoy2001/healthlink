<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="./changepassword.css" />
    <title>Change Password</title>
</head>

<body>
    <Section>
        <div class="card login-form">
            <div class="card-body">
                <h3 class="card-title text-center"><b>Change password</b></h3>

                <!--Password must contain one lowercase letter, one number, and be at least 7 characters long.-->

                <div class="card-text">
                    <form id="passwordForm">
                        <div class="alert alert-danger alert-dismissible fade show" role="alert" id="alertMessage" style="display: none;">
                            <!-- Alert message will be shown here -->
                        </div>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Your new password</label>
                            <input type="password" class="form-control form-control-sm shadowed" id="newPassword">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Repeat password</label>
                            <input type="password" class="form-control form-control-sm shadowed" id="repeatPassword">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block submit-btn">Confirm</button>
                    </form>
                </div>
            </div>
        </div>
    </Section>

    <!-- Include jQuery and Bootstrap JavaScript files -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#passwordForm').submit(function (e) {
                e.preventDefault(); // Prevent form submission

                // Retrieve passwords
                var newPassword = $('#newPassword').val();
                var repeatPassword = $('#repeatPassword').val();

                // Password validation
                var errorMessage = '';
                if (newPassword.length < 7) {
                    errorMessage += 'Password must be at least 7 characters long.<br>';
                }
                if (!newPassword.match(/[a-z]/)) {
                    errorMessage += 'Password must contain at least one lowercase letter.<br>';
                }
                if (!newPassword.match(/[0-9]/)) {
                    errorMessage += 'Password must contain at least one number.<br>';
                }
                if (newPassword !== repeatPassword) {
                    errorMessage += 'Passwords do not match.<br>';
                }

                // Show error message in alert
                if (errorMessage !== '') {
                    $('#alertMessage').html(errorMessage);
                    $('#alertMessage').show();
                } else {
                    $('#alertMessage').hide();
                    // If all validations passed, submit the form
                    this.submit();
                }
            });

            // Update alert messages dynamically as user types
            $('#newPassword, #repeatPassword').keyup(function () {
                var newPassword = $('#newPassword').val();
                var repeatPassword = $('#repeatPassword').val();
                var errorMessage = '';

                if (newPassword.length < 7) {
                    errorMessage += 'Password must be at least 7 characters long.<br>';
                }
                if (!newPassword.match(/[a-z]/)) {
                    errorMessage += 'Password must contain at least one lowercase letter.<br>';
                }
                if (!newPassword.match(/[0-9]/)) {
                    errorMessage += 'Password must contain at least one number.<br>';
                }
                if (newPassword !== repeatPassword) {
                    errorMessage += 'Passwords do not match.<br>';
                }

                if (errorMessage !== '') {
                    $('#alertMessage').html(errorMessage);
                    $('#alertMessage').show();
                } else {
                    $('#alertMessage').hide();
                }
            });
        });
    </script>
</body>

</html>
